package com.gl.controller;

import org.springframework.jdbc.core.JdbcTemplate;
import org.springframework.jdbc.datasource.SimpleDriverDataSource;
import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.ui.Model;   // For Model
import java.util.List;                 // For List
import java.util.Map;                  // For Map


@Controller
public class HotelController 
{

    @RequestMapping("/")   // default mapping
    public String addHotelForm() {
        return "addhotel";
    }

    @PostMapping("/savehotel")
    public String saveHotel(@RequestParam("name") String name,
                            @RequestParam("address") String address) 
    {
        try 
        {
            String url = "jdbc:mysql://localhost:3306/wipro_2025_hibernate";
            String username = "root";
            String password = "Balachandra@123";

            SimpleDriverDataSource dataSource = new SimpleDriverDataSource();
            dataSource.setDriver(new com.mysql.cj.jdbc.Driver());
            dataSource.setUrl(url);
            dataSource.setUsername(username);
            dataSource.setPassword(password);

            JdbcTemplate template = new JdbcTemplate(dataSource);
            String insert = "insert into hotel(name, address) values(?, ?)";
            template.update(insert, name, address);

            return "insertsuccess";

        } 
        catch (Exception ex) 
        {
            System.out.println("Error : " + ex.getMessage());
            return "insertfail";
        }
    }
    
    @RequestMapping("/hotel-list")
    public String readHotels(Model model) {
        try {
            String url = "jdbc:mysql://localhost:3306/wipro_2025_hibernate";
            String username = "root";
            String password = "Balachandra@123";

            SimpleDriverDataSource dataSource = new SimpleDriverDataSource();
            dataSource.setDriver(new com.mysql.cj.jdbc.Driver());
            dataSource.setUrl(url);
            dataSource.setUsername(username);
            dataSource.setPassword(password);

            JdbcTemplate template = new JdbcTemplate(dataSource);

            // Query all hotels
            String select = "SELECT * FROM hotel";
            List<Map<String, Object>> hotels = template.queryForList(select);

            // Add data to model
            model.addAttribute("hotels", hotels);

            return "hotellist";   // JSP page to display list
        } catch (Exception e) {
            e.printStackTrace();
            return "hotellisterror";   // Error JSP page
        }
    }

}
